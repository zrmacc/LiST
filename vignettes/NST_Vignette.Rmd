---
title: "Score Test for Normal Linear Models"
author: "Zachary McCaw"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Score Test for Normal Linear Models}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=2*3, fig.height=2*2, fig.align="center", fig.path='Figs/',echo=T, warning=F, message=F, cache=T, results='hold');
```

# Contents

* [Setting](#setting)
* [Example Data](#example-data)
* [Score Test](#score-test)

# Setting
Suppose that a continuous outcome $y_{i}\in\mathbb{R}$ and a covariate $x_{i}\in\mathbb{R}^{p}$ is observed for each of $n$ subjects. Consider the model:

$$
y_{i} \sim N(X\beta,\tau K)
$$

Here $K$ is a known or previously estimated covariance structure, and $\tau$ is an optional variance component. Partition $\beta = (\beta_{1},\beta_{2})$ and suppose $H_{0}:\beta_{1}=\beta_{10}$ is of interest. 

# Example Data
The list `NST::D` contains simulated data for $n=1000$ subjects. The outcome was generated by adding standard normal residuals to the subject specific means. The mean vector depends on a model matrix `Z` containing an intercept and three independent, standard normal covariates. `Beta` contains the regression parameters used to generate the outcome mean.

```{r, echo=F, eval=T}
library(NST);
D = NST::D;
# Extract components
y = D$y;
Z = D$Z;
cat("Outcome vector:","\n");
head(y);
cat("\n");
cat("Model matrix:","\n");
head(Z);
cat("\n");
cat("Regression parameters","\n");
show(D$Beta);
```

## Formatting Assumptions
The model matrix `Z` should be numeric, with all factors and interactions expanded. 

# Score Test
Score tests on $\beta$ are specified using a logical vector `L`. The length of `L` should match the number of columns in the model matrix `Z`. An element of `L` is set to `TRUE` if the regression coefficient for the corresponding column of `Z` is fixed under $H_{0}$. At least one element of `L` must be `TRUE` (i.e. a test must be specified) and at least on element of `L` must be `FALSE` (i.e. a null model must be estimable). The values of regression coefficients fixed under $H_{0}$ are specified using `b0`. By default, `b0` is the zero vector. 

Below, various hypothses are tested on the example data. The first is an overall test of $H_{0}:\beta_{1}=\beta_{2}=\beta_{3}=0$, which is false. The second assesses $H_{0}:\beta_{1}=\beta_{2}=0$, which is again false, treating $\beta_{3}$ as a nuisance. The third considers $H_{0}:\beta_{1}=0.1$, which is in fact true, treating $\beta_{2}$ and $\beta_{3}$ as nuisances. The final considers $H_{0}:\beta_{3}=0$, which is again true, treating $\beta_{1}$ and $\beta_{2}$ as nuisances. All models include an intercept $\beta_{0}$.

```{r, eval=T}
cat("Joint score test of b1 = b2 = b3 = 0","\n");
signif(Score.nlm(y=y,Z=Z,L=c(F,T,T,T)),digits=2);
cat("\n","Joint score test of b1 = b2 = 0, treating b3 as a nuisance","\n");
signif(Score.nlm(y=y,Z=Z,L=c(F,T,T,F)),digits=2);
cat("\n","Joint score test of b1 = 0.1, treating b2 and b3 as nuisances","\n");
signif(Score.nlm(y=y,Z=Z,L=c(F,T,F,F),,b0=0.1),digits=3);
cat("\n","Individual score test of b3 = 0, treating b1 and b2 as nuisances","\n");
signif(Score.nlm(y=y,Z=Z,L=c(F,F,F,T)),digits=3);
```
